# グローバルチャットの利用方針

## 目的
- ユーザーが複数PDFを横断して質問できるようにする
- 「このPDFだけ」の文脈と混ざらないように、会話と検索範囲を明確化する

## 推奨UX
- 通常チャット: 現在のPDFのみを検索対象にする
- グローバルチャット: ユーザーの全PDFを検索対象にする
- UIで検索範囲を常に表示（例: 「検索範囲: このPDF / すべてのPDF」）

## 運用ポリシー
- グローバルチャットは通常チャットとはスレッドを分離する
- 会話履歴は混在させず、用途ごとに保持する
- 回答には参照元PDF名を表示して誤解を防ぐ

## 技術要件（最低限）
- document_chunks に user_id を付与して、ユーザー単位で検索可能にする
- 検索時は user_id で必ずフィルタする
- 既存DB構成のまま、検索クエリの条件追加で実現可能

## リスクと対策
- 文脈混在: スレッド分離と検索範囲表示で回避
- 誤引用: 参照元PDF名を明示
- パフォーマンス: user_id インデックスを持たせる

## 実装優先度
1. グローバルチャットのスレッド分離
2. 検索範囲のUI表示・切替
3. 参照元PDF名の表示
4. 最適化（キャッシュ・ランキング調整）
